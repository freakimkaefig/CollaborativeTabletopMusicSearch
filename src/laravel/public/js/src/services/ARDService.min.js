MediathekCrawler.ARTEService=function(){var a={},b=null,c="http://www.arte.tv/papi/tvguide/epg/schedule/D/L3/",d="http://www.arte.tv/papi/tvguide/videos/plus7/search/D/L1/",e="/ALL/ALL/-1/AIRDATE_DESC/",f="/0.json",g="http://www.arte.tv/papi/tvguide/videos/plus7/D/L2/ALF/ALL/-1/VIEWS/",h="/0.json",i="http://www.arte.tv/papi/tvguide/videos/plus7/D/L2/",j="/ALL/-1/VIEWS/10/0.json",k="/proxy.php?url=",l="ARTE",n=[{_id:"nachrichten",_value:["ACT"]},{_id:"politik",_value:["SOC","GEO","EUR"]},{_id:"kinder",_value:["JUN"]},{_id:"kino-tv",_value:["CIN","DOC"]},{_id:"wissen-kultur",_value:["DEC","ART","CUL","ENV"]}];return init=function(a){b=a},getVideosByDate=function(a,b,c){b.indexOf(".")>0&&(b=_replaceAll(".","-",b)),b.indexOf("/")>0&&(b=_replaceAll("/","-",b)),c.indexOf(".")>0&&(c=_replaceAll(".","-",c)),c.indexOf("/")>0&&(c=_replaceAll("/","-",c)),this.getNew(a,b,c)},_checkARTEStartDate=function(a){var b=new Date,c=b.getDate();1==c.toString().length&&(c="0"+c);var d=b.getMonth()+1;1==d.toString().length&&(d="0"+d);var e=b.getFullYear();return b=e+"-"+d+"-"+c,a},getCategories=function(a){var b={_channel:"ARTE",_method:"getCategories",_searchTerm:a,_badge:null},c=n.filter(function(b){return b._id==a});c.length>0?$.each(c[0]._value,function(a,c){_getARTEBroadcastOfCategory(b,c)}):console.warn("ERROR; ARTEService.getCategories; Category not found")},_getARTEBroadcastOfCategory=function(a,c){$.ajax({url:k+encodeURI(i+String(c)+j),type:"GET",cache:!1,success:function(c){try{var d=$.parseJSON(c)}catch(e){var d=c}var f=d.videoList;f.length>0&&$.each(f,function(c,d){var e=[],g="",h="",i=0,j="",k="",m="",n="",o="";try{var p=_getResolution(d.programImage);if(0!==p&&p.length>6){var q=b.createTeaserImage(p,d.programImage);e.push(q)}}catch(r){}try{var p=_getResolution(d.element.VTU.IUR);if(0!==p&&p.length>6){var s=b.createTeaserImage(p,d.VTU.IUR);e.push(s)}}catch(r){}try{g=d.VDE}catch(r){}try{h=d.VTI}catch(r){}try{i=d.VPI}catch(r){}try{j=_formatSeconds(60*String(d.VDU))}catch(r){}try{k=d.VDA,k=String(k).slice(0,k.length-5),k=k.trim(),k.indexOf("/")>0&&(k=_replaceAll("/",".",k)),k=k.slice(0,k.length-3)}catch(r){}try{m=l}catch(r){}try{o=d.VSU,void 0===o&&(o=""),o=o+" ("+d.VCG+")"}catch(r){}try{n=d.videoStreamUrl}catch(r){}""!==n?_searchARTEStreams(a,i,h,o,g,m,j,k,e,n):console.log("Could not fetch streamURL for ",h," with ID: ",i)})},error:function(a,b,c){console.warn("ERROR; ARTEService._getARTEBroadcastOfCategory; AJAX-request did not recieve a response\n",a,b,c)}})},getHot=function(a){(1>a||null===a||"undefined"===a||void 0===a)&&(a=10);var b={_channel:"ARTE",_method:"getHot",_searchTerm:null,_badge:"hot"},c=k+encodeURI(g+String(a)+h);$.ajax({url:c,type:"GET",cache:!1,success:function(a){_onARTEGetHot(b,a)},error:function(a,b,c){console.warn("ERROR; ARTEService.getHot; AJAX-request did not recieve a response\n",a,b,c)}})},_onARTEGetHot=function(a,c){try{var d=$.parseJSON(c)}catch(e){var d=c}var f=d.videoList;f.length>0&&$.each(f,function(c,d){var e=[],g="",h="",i=0,j="",k="",m="",n="",o="";try{var p=_getResolution(d.programImage);if(0!==p&&p.length>6){var q=b.createTeaserImage(p,d.programImage);e.push(q)}}catch(r){}try{var p=_getResolution(d.element.VTU.IUR);if(0!==p&&p.length>6){var s=b.createTeaserImage(p,d.VTU.IUR);e.push(s)}}catch(r){}try{g=d.VDE}catch(r){}try{h=d.VTI}catch(r){}try{i=d.VPI}catch(r){}try{j=_formatSeconds(60*String(d.VDU))}catch(r){}try{k=d.VDA,k=String(k).slice(0,k.length-5),k=k.trim(),k.indexOf("/")>0&&(k=_replaceAll("/",".",k)),k=k.slice(0,k.length-3)}catch(r){}try{m=l}catch(r){}try{o=d.VSU,void 0===o&&(o=""),o=o+" ("+d.VCG+")"}catch(r){}try{n=d.videoStreamUrl}catch(r){}""!==n?_searchARTEStreams(a,i,h,o,g,m,j,k,e,n):console.log("Could not fetch streamURL for ",h," with ID: ",i)})},searchString=function(a,b){(1>b||null===b||"undefined"===b||void 0===b)&&(b=10);var c={_channel:"ARTE",_method:"searchString",_searchTerm:a,_badge:null},g=k+encodeURI(d+String(a)+e+String(b)+f);$.ajax({url:g,type:"GET",dataType:"json",cache:!1,success:function(a){_onARTESearchString(c,a)},error:function(a,b,c){console.warn("ERROR; ARTEService.searchString; AJAX-request did not recieve a response\n",a,b,c)}})},_onARTESearchString=function(a,c){var d=c.videoList;d.length>0&&$.each(d,function(c,d){var e=[],g="",h="",i=0,j="",k="",m="",n="",o="";try{var p=_getResolution(d.programImage);if(0!==p&&p.length>6){var q=b.createTeaserImage(p,d.programImage);e.push(q)}}catch(r){}try{var p=_getResolution(d.element.VTU.IUR);if(0!==p&&p.length>6){var s=b.createTeaserImage(p,d.VTU.IUR);e.push(s)}}catch(r){}try{g=d.VDE}catch(r){}try{h=d.VTI}catch(r){}try{i=d.VPI}catch(r){}try{j=_formatSeconds(60*String(d.VDU))}catch(r){}try{k=d.VDA,k=String(k).slice(0,k.length-5),k=k.trim(),k.indexOf("/")>0&&(k=_replaceAll("/",".",k)),k=k.slice(0,k.length-3)}catch(r){}try{m=l}catch(r){}try{o=d.VSU,void 0===o&&(o=""),o=o+" ("+d.VCG+")"}catch(r){}try{n=d.videoStreamUrl}catch(r){}""!==n?_searchARTEStreams(a,i,h,o,g,m,j,k,e,n):console.log("Could not fetch streamURL for ",h," with ID: ",i)})},_getResolution=function(a){try{if(-1==a.indexOf("ORIGINAL")){var b=a,c=b.search(/[W]\d+[H]\d+/),d=b.indexOf("/",c+1);return resolution=b.substring(c,d),resolution=resolution.substring(1),resolution=resolution.replace("H","x"),resolution=resolution.trim()}return 0}catch(e){return console.log("ARTE; ERROR _getResolution() - url: ",a,", e: ",e),0}},getNew=function(a,b,d){var e=b,f=d,g={};if(!e||void 0===e||""===e||null===e||!f||void 0===f||""===f||null===f){g={_channel:"ARTE",_method:"getNew",_searchTerm:null,_badge:"new"};var h=new Date,i=h.getDate();1==i.toString().length&&(i="0"+i);var j=h.getMonth()+1;1==j.toString().length&&(j="0"+j);var l=h.getFullYear();h=l+"-"+j+"-"+i,f=h;var m=new Date;m.setDate(m.getDate()-2);var n=m.getDate();1==n.toString().length&&(n="0"+n);var o=m.getMonth()+1;1==o.toString().length&&(o="0"+o);var p=m.getFullYear();m=p+"-"+o+"-"+n,e=m}var q=k+encodeURI(c+String(e)+"/"+String(f)+".json");$.ajax({url:q,type:"GET",cache:!1,dataType:"json",success:function(b){_onARTEGetNew(g,b,a)},error:function(a,b,c){console.warn("ERROR; ARTEService.getNew; AJAX-request did not recieve a response\n",a,b,c)}})},_replaceAll=function(a,b,c){return c.replace(new RegExp(a,"g"),b)},_onARTEGetNew=function(a,c,d){var e=1,f=c.abstractBroadcastList;void 0!==c&&f.length>0?$.each(f,function(c,f){if(d>=e){var g=[],h="",i="",j=0,k="",m="",n="",o="",p="";try{var q=_getResolution(f.IMG.IUR);if(0!==q&&q.length>6){var r=b.createTeaserImage(q,f.IMG.IUR);g.push(r)}}catch(s){}try{var q=_getResolution(f.VDO.programImage);if(0!==q&&q.length>6){var t=b.createTeaserImage(q,f.VDO.programImage);g.push(t)}}catch(s){}try{var q=_getResolution(f.VDO.VTU.original);if(0!==q&&q.length>6){var u=b.createTeaserImage(q,f.VDO.VTU.original);g.push(u)}}catch(s){}try{var q=_getResolution(f.VDO.VTU.IUR);if(0!==q&&q.length>6){var v=b.createTeaserImage(q,f.VDO.VTU.IUR);g.push(v)}}catch(s){}try{h=f.VDO.VTX+": "+f.DSS}catch(s){}try{i=f.TIT}catch(s){}try{j=f.programId}catch(s){}try{k=_formatSeconds(60*String(f.VDS[0].VDU))}catch(s){}try{m=f.BDT,m=String(m).slice(0,m.length-5),m=m.trim(),m.indexOf("/")>0&&(m=_replaceAll("/",".",m)),m=m.slice(0,m.length-3)}catch(s){}try{n=l}catch(s){}try{p=f.STL,void 0===p&&(p=""),p=p+" ("+f.VDO.genre+")"}catch(s){}try{o=f.VDO.videoStreamUrl}catch(s){}""!==o||g.length<0?_searchARTEStreams(a,j,i,p,h,n,k,m,g,o):console.log("Could not fetch streamURL for ",i," with ID: ",j),e++}}):console.log("ARTE _ongetNew - response was: ",c)},_formatSeconds=function(a){var b=new Date(1970,0,1);b.setSeconds(a);var c=b.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1");return c},_searchARTEStreams=function(a,c,d,e,f,g,h,i,j,l){var m=[],n=null,o=k+encodeURI(l);$.ajax({url:o,type:"GET",cache:!1,success:function(c){try{n=$.parseJSON(c)}catch(k){n=c}try{var o=n.video.VSR;o.length>0&&$.each(o,function(a,c){var d="",e="",f="",g=0,h="video/mp4";try{if("HBBTV"==String(c.VFO)){switch(f=c.VUR,c.VQU){case"SQ":e=3;break;case"EQ":e=0;break;case"MQ":e=1;break;case"HQ":e=2}var i=b.createStream(d,h,e,f,g);m.push(i)}}catch(j){}})}catch(k){}if(m.length<1){var p=l.indexOf("stream")+6;[l.slice(0,p),"/player",l.slice(p)].join("")}else _pushARTEResultToModel(a,g,d,e,f,h,i,j,m)},error:function(a,b,c){console.warn("ERROR; ARTEService._searchARTEStreams; AJAX-request did not recieve a response\n",a,b,c)}})},_pushARTEResultToModel=function(a,c,d,e,f,g,h,i,j){b.addResults(a,c,d,e,f,g,h,i,j)},dispose=function(){a={}},a.init=init,a.dispose=dispose,a.searchString=searchString,a.getNew=getNew,a.getHot=getHot,a.getCategories=getCategories,a.getVideosByDate=getVideosByDate,a};