MediathekCrawler.BRService=function(){var a={},b="http://www.br.de",c="/proxy.php?url=",d="http://www.br.de/mediathek/video/programm/index.html";return BR_HOT_URL="http://www.br.de/mediathek/video/suche/tag-suche-mediathek-100~tagSearchMoreResults_count-12_entireBroadcast-false_start-0_-915410257bf253a3d2f95cebbaf43688c1e4944b.json?q=mostViewed&t=social",SEARCH_URL="http://www.br.de/mediathek/video/suche/?query=",SEARCH_PARAM_SORT_RELEVANCE="&sort=relevance",SEARCH_PARAM_SORT_DATE="&sort=date",SEARCH_PARAM_ENTIRE_BROADCAST="&entireBroadcast=true",SEARCH_PARAM_SUBTITLES="&subtitles=true",SEARCH_PARAM_PERIOD_TODAY="&period=today",SEARCH_PARAM_PERIOD_YESTERDAY="&period=yesterday",SEARCH_PARAM_PERIOD_WEEK="&period=week",SEARCH_PARAM_PERIOD_MONTH="&period=month",SEARCH_PARAM_DATE_FROM="&dateFrom=",SEARCH_PARAM_DATE_UNTIL="&dateUntil=",SEARCH_WRAPPER_ELEMENT="#teaserBundleSearch",SEARCH_ITEM_WRAPPER="article.teaser",SEARCH_ITEM_URL="a.link_video",_model=null,getDatesOnce=1,init=function(a){_model=a},searchString=function(a,b){var c={_channel:"BR",_method:"searchString",_searchTerm:a,_badge:null};switch(b){case 0:searchStringByRelevance(a,c);break;case 1:searchStringByDate(a,c)}},searchStringByRelevance=function(a,b){var d=c+encodeURI(SEARCH_URL+a+SEARCH_PARAM_SORT_RELEVANCE);$.ajax({url:d,type:"GET",cache:!1,success:function(a){onSearchString(a,b)},error:function(a,b,c){console.warn("ERROR; BRService.searchStringByRelevance; AJAX-request did not recieve a response\n",a,b,c)}})},searchStringByDate=function(a,b){var d=c+encodeURI(SEARCH_URL+a+SEARCH_PARAM_SORT_DATE);$.ajax({url:d,type:"GET",cache:!1,success:function(a){onSearchString(a,b)},error:function(a,b,c){console.warn("ERROR; BRService.searchStringByDate; AJAX-request did not recieve a response\n",a,b,c)}})},onSearchString=function(a,b){$(a).find(".teaserInner").each(function(a,c){var d=$(c).find(".link_video").attr("href");void 0!==d&&loadDetails(d,b)})},loadDetails=function(a,d){var e=c+encodeURI(b+a);$.ajax({url:e,type:"GET",cache:!1,success:function(a){onLoadDetails(a,d)},error:function(a,b,c){console.warn("ERROR; BRService.loadDetails; AJAX-request did not recieve a response\n",a,b,c)}})},_fixBRLength=function(a){if(a.indexOf(" Min")>0&&(a=a.replace(" Min","")),Number(a)>60){var b=String(parseInt(a/60));Number(b)<10&&(b="0"+String(b));var c=String(Number(a)-60*Number(b));return Number(c)<10&&(c="0"+String(c)),b+":"+c+":00"}return Number(a)<=60?(Number(a)<10&&(a="0"+String(a)),"00:"+String(a)+":00"):a},_replaceAll=function(a,b,c){return c.replace(new RegExp(a,"g"),b)},onLoadDetails=function(a,c){var d=$(a).find("#playerFrame .player .avPlayer figure .clearFix a").attr("onclick");if(void 0!==d){var e=d.match(/\{dataURL:'(.*?)\'}/),f=null;if(e){var g=e[1];f=$(a).find(".bcastData ul.meta li.duration time.duration").text(),f=f.replace(".","");var h={};h._station="BR",h._subtitle=$(a).find(".bcastData ul.title li.title").text(),h._title=$(a).find(".bcastData header h3").text(),h._length=_fixBRLength(f),h._airtime=$(a).find(".bcastData ul.meta li.start time.start").text().replace(",",""),h._airtime=h._airtime.replace("Uhr,",""),h._details=$(a).find("#bcastInfo .bcastContent p").text()+$(a).find("#bcastInfo .bcastContent div.cast").text(),h._teaserImages=[],h._teaserImages.push(_model.createTeaserImage("108x61",b+$(a).find("#playerFrame .player .avPlayer figure .clearFix a figure img").data("src-s"))),h._teaserImages.push(_model.createTeaserImage("320x180",b+$(a).find("#playerFrame .player .avPlayer figure .clearFix a figure img").data("src-m"))),h._teaserImages.push(_model.createTeaserImage("400x255",b+$(a).find("#playerFrame .player .avPlayer figure .clearFix a figure img").data("src-l"))),h._teaserImages.push(_model.createTeaserImage("640x360",b+$(a).find("#playerFrame .player .avPlayer figure .clearFix a figure img").data("src-xl"))),h._streams=[],loadStreams(h,g,c)}}},loadStreams=function(a,d,e){var f=c+encodeURI(b+d);$.ajax({url:f,type:"GET",cache:!1,success:function(b){onLoadStreams(a,b,e)},error:function(a,b,c){console.warn("ERROR; BRService.loadStreams; AJAX-request did not recieve a response\n",a,b,c)}})},onLoadStreams=function(a,b,c){var d=$(b).find("assets").find("asset");$(d).each(function(b,c){if("HDS"!==$(c).attr("type")){var d=null,e="video/"+$(c).find("mediaType").text(),f=$(c).attr("type"),g=$(c).find("downloadUrl").text(),h=$(c).find("size").text();switch(f){case"MOBILE":f=0;break;case"MOBILES":f=0;break;case"STANDARD":f=1;break;case"LARGE":f=2;break;case"PREMIUM":f=3;break;case"HD":f=3}a._streams.push(_model.createStream(d,e,f,g,h))}}),a._streams.length>0&&_model.addResults(c,a._station,a._title,a._subtitle,a._details,a._length,a._airtime,a._teaserImages,a._streams)},getBRNew=function(a,e){a&&void 0!==a&&null!==a||(a=20),$today=new Date;var f=$today.getDate();10>f&&(f="0"+f);var g=f,h=["Januar","Februar","M\xe4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],i=h[$today.getMonth()],j=h[$today.getMonth()-1],k=new Date($today.getFullYear(),$today.getMonth()-1+1,0);k=k.getDate();var l={_channel:"BR",_method:"getBRNew",_searchTerm:null,_badge:"new"};if(e&&void 0!==e&&null!==e){var m=c+encodeURI(e);$.ajax({url:m,type:"GET",cache:!1,success:function(b){onGetBRNew(a,b,l)},error:function(a,b,c){console.warn("ERROR; BRService.getBRNew; AJAX-request did not recieve a response\n",a,b,c)}})}else if(a>1){var m=c+encodeURI(d);$.ajax({url:m,type:"GET",cache:!1,success:function(c){onGetBRNew(a,c,l);var d=$(c).find(".epgCalendar").find("td");$(d).each(function(c,d){if(parseInt(g)>2){var e=$(d).text();if(e.indexOf(i)>0){var f=parseInt(g)-1,h=parseInt(e.slice(0,e.indexOf(".")));(h===f||h===f-1)&&getBRNew(a,b+$(d).find("a").attr("href"))}}else if(2===parseInt(g)){var e=$(d).text();if(e.indexOf(i)>0){var f=parseInt(g)-1,h=parseInt(e.slice(0,e.indexOf(".")));h===f&&getBRNew(a,b+$(d).find("a").attr("href"))}if(e.indexOf(j)>0){var h=parseInt(e.slice(0,e.indexOf(".")));h===k&&getBRNew(a,b+$(d).find("a").attr("href"))}}else if(1===parseInt(g)){var e=$(d).text();if(e.indexOf(j)>0){var h=parseInt(e.slice(0,e.indexOf(".")));(h===k||h===k-1)&&getBRNew(a,b+$(d).find("a").attr("href"))}}})},error:function(a,b,c){console.warn("ERROR; BRService.getBRNew; AJAX-request did not recieve a response\n",a,b,c)}})}else{var m=c+encodeURI(d);$.ajax({url:m,type:"GET",cache:!1,success:function(b){onGetBRNew(a,b,l)},error:function(a,b,c){console.warn("ERROR; BRService.getBRNew; AJAX-request did not recieve a response\n",a,b,c)}})}},onGetBRNew=function(a,b,c){a&&void 0!==a&&null!==a||(a=20);var d=$(b).find(".epgContainer").find("#BFS"),e=$(d).find(".videoAvailable"),f=1;$(e).each(function(b,d){if(a>=f){var e=$(d).attr("data-ondemand_url");void 0!==e&&loadDetails(e,c),f++}})},getBRHot=function(){var a={_channel:"BR",_method:"getBRHot",_searchTerm:null,_badge:"hot"},b=c+encodeURI(BR_HOT_URL);$.ajax({url:b,type:"GET",cache:!1,success:function(b){onGetBRHot(b,a)},error:function(a,b,c){console.warn("ERROR; BRService.getBRHot; AJAX-request did not recieve a response\n",a,b,c)}})},onGetBRHot=function(){},_checkSRFDuplicates=function(a,b){for(i=0;i<a.length;i++)if(a[i].match(b))return!1;return!0},getBRVideosByDate=function(a,b){var e={};Date.prototype.addDays=function(a){var b=new Date(this.valueOf());return b.setDate(b.getDate()+a),b};for(var f=[],g=new Date(a),h=new Date(b);h>=g;){var i="",j=g.getDate(),k=g.getMonth()+1,l=g.getFullYear();10>j&&(j="0"+j),10>k&&(k="0"+k),i=j+"."+k+"."+l,f.push(i),g=g.addDays(1)}var m=c+encodeURI(d);$.ajax({url:m,type:"GET",cache:!1,success:function(a){_onBRVideosByDate(a,e,f)},error:function(a,b,c){console.warn("ERROR; BRService.getBRVideosByDate; AJAX-request did not recieve a response\n",a,b,c)}})},_onBRVideosByDate=function(a,c,d){var e=[];for(i=0;i<d.length;i++){var f=d[i].slice(3,6)+d[i].slice(0,3)+d[i].slice(6,10);$today=new Date(f);var g=$today.getDate();10>g&&(g="0"+g);var h=g,j=["Januar","Februar","M\xe4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],k=j[$today.getMonth()],l=$(a).find(".epgCalendar").find("td");$(l).each(function(a,d){var f=$(d).text(),g=parseInt(f.slice(0,f.indexOf(".")));if(10>g&&(g="0"+g),f.indexOf(k)>0&&g===h){var i=b+$(d).find("a").attr("href");_checkSRFDuplicates(e,i)&&(getBRNew(null,i,c),e.push(i))}})}},dispose=function(){a={}},a.init=init,a.dispose=dispose,a.searchString=searchString,a.getBRNew=getBRNew,a.getBRHot=getBRHot,a.getBRVideosByDate=getBRVideosByDate,a};