MediathekCrawler.DasErsteService=function(){var a={},b="http://mediathek.daserste.de",c="/proxy.php?url=",d="http://mediathek.daserste.de/tv/sendungVerpasst?datum=",e="http://mediathek.daserste.de/tv/suche?searchText=",f="&topRessort=tv&sort=score",g="&topRessort=tv&sort=date",n="Das Erste",t="http://www.ardmediathek.de/play/media/",A=[{quality:"xs",resolution:"128x72"},{quality:"s",resolution:"256x144"},{quality:"m",resolution:"512x288"},{quality:"l",resolution:"960x540"}],D=null,E=null,F=function(a){D=a,E=[]},G=function(a,b){var c={_channel:"DasErste",_method:"searchString",_searchTerm:a,_badge:null};switch(b){case 0:H(c,a);break;case 1:I(c,a)}},H=function(a,b){var d=c+encodeURI(e+b+f);$.ajax({url:d,type:"GET",cache:!1,success:function(b){J(a,b)},error:function(a,b,c){console.warn("ERROR; DasErsteService.searchDASERSTEStringByRelevance; AJAX-request did not recieve a response\n",a,b,c)}})},I=function(a,b){var d=c+encodeURI(e+b+g);$.ajax({url:d,type:"GET",cache:!1,success:function(b){J(a,b)},error:function(a,b,c){console.warn("ERROR; DasErsteService.searchDASERSTEStringByDate; AJAX-request did not recieve a response\n",a,b,c)}})},J=function(a,c){var d=$(c).find(".flash");d.each(function(c,d){var e={};e._streams=[],documentUrl=$(d).find(".mediaLink").attr("href"),documentId=documentUrl.slice(documentUrl.indexOf("documentId=")+11,documentUrl.indexOf("&topRessort"));var f=$(d).find(".mediaLink").find(".img");e._teaserImages=[];var g=null,h=null,i=null,j=$(f).attr("data-ctrl-image");j=j.slice(j.indexOf("urlScheme':'")+12,j.indexOf("##width##")),j+="384",j.indexOf("16x9")>0?(h=j.slice(j.indexOf("16x9/")+5,j.length),i=parseInt(h/1.7777),g=h+"x"+i,e._teaserImages.push(D.createTeaserImage(g,b+j))):e._teaserImages.push(D.createTeaserImage(A[0].resolution,b+j)),L(a,documentId,e,b+documentUrl)})},K=function(a,e,f){var g=null,h=null,j={};Date.prototype.addDays=function(a){var b=new Date(this.valueOf());return b.setDate(b.getDate()+a),b};for(var k=[],l=new Date(e),m=new Date(f);m>=l;)k.push(String(l.getDate())+"."+String(l.getMonth()+1)+"."+String(l.getFullYear())),l=l.addDays(1);for(i=0;i<k.length;i++){var o=c+d+String(k[i]);$.ajax({url:o,type:"GET",cache:!1,success:function(a){var c=$(a).find(".teaserbox");c.each(function(a,c){var d=$(c).find(".teaser");d.each(function(a,c){var d={};d._streams=[],g=$(c).find(".mediaLink").attr("href"),h=g.slice(g.indexOf("documentId=")+11,g.indexOf("&topRessort"));var e=$(c).find(".mediaLink").find(".img");d._teaserImages=[];var f=null,i=null,k=null,l=$(e).attr("data-ctrl-image");l=l.slice(l.indexOf("urlScheme':'")+12,l.indexOf("##width##")),l+="384",l.indexOf("16x9")>0?(i=l.slice(l.indexOf("16x9/")+5,l.length),k=parseInt(i/1,7777),f=i+"x"+k,d._teaserImages.push(D.createTeaserImage(f,b+l))):d._teaserImages.push(D.createTeaserImage(A[0].resolution,b+l)),L(j,h,d,b+g)})})},error:function(a,b,c){console.warn("ERROR; DasErsteService.getDasErsteVideosByDate; AJAX-request did not recieve a response\n",a,b,c)}})}},L=function(a,b,d,e){var e=c+encodeURI(e);$.ajax({url:e,type:"GET",cache:!1,success:function(c){M(a,b,d,c)},error:function(a,b,c){console.warn("ERROR; DasErsteService.loadDASERSTEDetails; AJAX-request did not recieve a response\n",a,b,c)}})},M=function(a,b,c,d){var e=c,f=$(d).find(".modClipinfo");if(e._station=n,!e._title||void 0===e._title)try{e._title=$(d).find(".dachzeile").text()}catch(g){}if(!e._subtitle||void 0===e._subtitle||""===e._subtitle)try{var h=$(f).find(".headline");e._subtitle=$(h).text()}catch(g){}if(!e._length||void 0===e._length||""===e._length)try{var h=$(f).find(".subtitle");$(h).text().indexOf("|")>0?(e._length=$(h).text(),e._length="00:"+e._length.slice(e._length.indexOf(" | ")+3,e._length.indexOf(" Min"))):e._length=""}catch(g){}if(!e._airtime||void 0===e._airtime||""===e._airtime||e._airtime.indexOf("undefined")>0)try{var h=$(f).find(".subtitle");e._airtime=$(h).text(),e._airtime.indexOf("|")>0&&(e._airtime=e._airtime.slice(0,e._airtime.indexOf(" | "))),e._subtitle.indexOf("Uhr")>0&&(e._airtime+=" "+e._subtitle.slice(e._subtitle.indexOf("Uhr")-6,e._subtitle.indexOf("Uhr")),e._subtitle.indexOf(",")>0&&(e._subtitle=e._subtitle.slice(0,e._subtitle.indexOf(","))))}catch(g){}if(!e._streams||void 0===e._streams,!e._details||void 0===e._details||""===e._details)try{var h=$(f).find(".teasertext");e._details=$(h).text()}catch(g){}N(a,b,e)},N=function(a,b,d){var e=c+encodeURI(t+b);$.ajax({url:e,type:"GET",cache:!1,success:function(c){O(a,b,d,c)},error:function(a,b,c){console.warn("ERROR; DasErsteService.loadDASERSTEStreams; AJAX-request did not recieve a response\n",a,b,c)}})},O=function(a,b,c,d){try{var d=JSON.parse(d)}catch(e){var d=d}c._streams=[];for(var f=0;f<d._mediaArray.length;f++)for(var g=0;g<d._mediaArray[f]._mediaStreamArray.length;g++){var h=d._mediaArray[f]._mediaStreamArray[g]._server,i=d._mediaArray[f]._mediaStreamArray[g]._stream;if("string"==typeof i)var j=i;else var j=i[0];var k=null,l=d._type+"/"+j.substr(j.lastIndexOf(".")+1);if(_quality=d._mediaArray[f]._mediaStreamArray[g]._quality,_filesize=null,""!==h){var j=h+i;l="rtmp/mp4"}c._streams.push(D.createStream(k,l,_quality,j,_filesize))}D.addResults(a,c._station,c._title,c._subtitle,c._details,c._length,c._airtime,c._teaserImages,c._streams)},P=function(a){var d={_channel:"DasErste",_method:"getNew",_searchTerm:null,_badge:"new"},e=c+encodeURI(b);$.ajax({url:e,type:"GET",cache:!1,success:function(b){Q(a,d,b)},error:function(a,b,c){console.warn("ERROR; DasErsteService.getNew; AJAX-request did not recieve a response\n",a,b,c)}})},Q=function(a,c,d){a&&void 0!==a&&null!==a||(a=20);var e=null,f=null,g=$(d).find(".modHeadline"),h=1;g.each(function(d,g){if("Neueste Videos"===$(g).text()){temp=$(g).next();var i=$(temp).find(".box");i.each(function(d,g){if(a>=h){var i={};i._streams=[],e=$(g).find(".mediaLink").attr("href"),f=e.slice(e.indexOf("documentId=")+11,e.indexOf("&topRessort"));var j=$(g).find(".mediaLink").find(".img");i._teaserImages=[];var k=null,l=null,m=null,n=$(j).attr("data-ctrl-image");n=n.slice(n.indexOf("urlScheme':'")+12,n.indexOf("##width##")),n+="384",n.indexOf("16x9")>0?(l=n.slice(n.indexOf("16x9/")+5,n.length),m=parseInt(l/1,7777),k=l+"x"+m,i._teaserImages.push(D.createTeaserImage(k,b+n))):i._teaserImages.push(D.createTeaserImage(A[0].resolution,b+n)),++h,L(c,f,i,b+e)}})}})},R=function(){var a={_channel:"DasErste",_method:"getHot",_searchTerm:null,_badge:"hot"},d=c+encodeURI(b);$.ajax({url:d,type:"GET",cache:!1,success:function(b){S(a,b)},error:function(a,b,c){console.warn("ERROR; DasErsteService.getHot; AJAX-request did not recieve a response\n",a,b,c)}})},S=function(a,d){var e=c+encodeURI(b+$(d).find(".modButton").find(".textLink").attr("href"));e&&void 0!==e?$.ajax({url:e,type:"GET",cache:!1,success:function(b){T(a,b)},error:function(a,b,c){console.warn("ERROR; DasErsteService.onDASERSTEGetHot; AJAX-request did not recieve a response\n",a,b,c)}}):console.log("DasErste onDASERSTEGetHot could not fetch _url! ",e)},T=function(a,c){var d=$(c).find(".flash");d.each(function(c,d){var e={};e._streams=[],documentUrl=$(d).find(".mediaLink").attr("href"),documentId=documentUrl.slice(documentUrl.indexOf("documentId=")+11,documentUrl.indexOf("&topRessort"));var f=$(d).find(".mediaLink").find(".img");e._teaserImages=[];var g=null,h=null,i=null,j=$(f).attr("data-ctrl-image");j=j.slice(j.indexOf("urlScheme':'")+12,j.indexOf("##width##")),j+="384",j.indexOf("16x9")>0?(h=j.slice(j.indexOf("16x9/")+5,j.length),i=parseInt(h/1.7777),g=h+"x"+i,e._teaserImages.push(D.createTeaserImage(g,b+j))):e._teaserImages.push(D.createTeaserImage(A[0].resolution,b+j)),L(a,documentId,e,b+documentUrl)})},U=function(){a={}};return a.init=F,a.dispose=U,a.searchString=G,a.getNew=P,a.getHot=R,a.getDasErsteVideosByDate=K,a};