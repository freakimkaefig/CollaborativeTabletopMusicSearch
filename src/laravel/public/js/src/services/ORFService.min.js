MediathekCrawler.ORFService=function(){var a={},c="/proxy.php?url=",e="http://tvthek.orf.at/search?q=",f="http://tvthek.orf.at/newest",g="http://tvthek.orf.at/most_viewed";return STREAM_URL="",_model=null,once=1,init=function(a){_model=a},_fixORFLength=function(a){if(a.indexOf(" Min.")>0)return a=a.replace(" Min.",""),"00:"+a;if(a.indexOf(" Std.")>0){a=a.replace(" Std.","");var b=Number(a.slice(0,2)),c=Number(a.slice(3,5));return Number(b)<10&&(b="0"+String(b)),Number(c)<10&&(c="0"+String(c)),b+":"+c+":00"}},_replaceAll=function(a,b,c){return c.replace(new RegExp(a,"g"),b)},searchString=function(a){var b={_channel:"ORF",_method:"searchString",_searchTerm:a,_badge:null},d=c+encodeURI(e+a);$.ajax({url:d,type:"GET",cache:!1,success:function(a){onORFLoadDetails(a,b)},error:function(a,b,c){console.warn("ERROR; ORFService.searchString; AJAX-request did not recieve a response\n",a,b,c)}})},getNew=function(a){var b={_channel:"ORF",_method:"getNew",_searchTerm:null,_badge:"new"},d=c+encodeURI(f);$.ajax({url:d,type:"GET",cache:!1,success:function(c){onORFLoadDetails(c,b,a)},error:function(a,b,c){console.warn("ERROR; ORFService.getNew; AJAX-request did not recieve a response\n",a,b,c)}})},getHot=function(){var a={_channel:"ORF",_method:"getHot",_searchTerm:null,_badge:"hot"},b=c+encodeURI(g);$.ajax({url:b,type:"GET",cache:!1,success:function(b){onORFLoadDetails(b,a)},error:function(a,b,c){console.warn("ERROR; ORFService.getHot; AJAX-request did not recieve a response\n",a,b,c)}})},onORFLoadDetails=function(a,b,c){c&&void 0!==c&&null!==c||(c=15);var d=1,e=$(a).find(".item");e.each(function(a,e){if(c>=d){if($(e).length>0){var f=$(e).find("a").attr("href"),g={};g._station="ORF",g._title=$(e).find(".item_title").text(),g._subtitle="",g._length=$(e).find(".meta_duration").text(),g._length=_fixORFLength(g._length),g._details=$(e).find(".item_description").text(),g._airtime=$(e).find(".meta_date").text(),g._airtime=g._airtime.slice(4,100),g._airtime+=" "+$(e).find(".meta_time").text(),g._airtime=g._airtime.replace(" Uhr",""),g._teaserImages=[],g._teaserImages.push(_model.createTeaserImage("395x209",$(e).find(".item_image").find("img").attr("src"))),g._streams=[],loadORFStreams(f,g,b)}d++}})},loadORFStreams=function(a,b,d){var e=c+encodeURI(a);$.ajax({url:e,type:"GET",cache:!1,success:function(c){onloadORFStreams(a,b,c,d)},error:function(a,b,c){console.warn("ERROR; ORFService.loadORFStreams; AJAX-request did not recieve a response\n",a,b,c)}})},onloadORFStreams=function(a,b,c,d){try{var e=JSON.parse($(c).find(".service_link_play").attr("data-jsb")),f=e.video.sources;for(i=0;i<=f.length;i++)if("http"===f[i].protocol&&f[i].src.indexOf(".mp4")>0&&-1===f[i].src.indexOf("3gp")&&-1===f[i].src.indexOf("m3u8")&&-1===f[i].src.indexOf("rtmp")&&-1===f[i].src.indexOf("rtsp")&&-1===f[i].src.indexOf("f4m")){var g="",h="",j=f[i].src,k=0,l="video/mp4";switch(f[i].quality_string){case"hoch":h=3;break;case"mittel":h=2;break;case"niedrig":h=1}var m=_model.createStream(g,l,h,j,k);b._streams.push(m)}}catch(n){try{var e=JSON.parse($(c).find(".player_viewport").find(".jsb_VideoPlaylist").attr("data-jsb")),f=e.selected_video.sources;for(i=0;i<=f.length;i++)if("http"===f[i].protocol&&f[i].src.indexOf(".mp4")>0&&-1===f[i].src.indexOf("3gp")&&-1===f[i].src.indexOf("m3u8")&&-1===f[i].src.indexOf("rtmp")&&-1===f[i].src.indexOf("rtsp")&&-1===f[i].src.indexOf("f4m")){var g="",h="",j=f[i].src,k=0,l="video/mp4";switch(f[i].quality_string){case"hoch":h=3;break;case"mittel":h=2;break;case"niedrig":h=1}var m=_model.createStream(g,l,h,j,k);b._streams.push(m)}}catch(n){}}b._streams.length>0&&_model.addResults(d,b._station,b._title,b._subtitle,b._details,b._length,b._airtime,b._teaserImages,b._streams)},dispose=function(){a={}},a.init=init,a.dispose=dispose,a.searchString=searchString,a.getNew=getNew,a.getHot=getHot,a};