MediathekCrawler.SRFService=function(){var a={},b=null,c="/proxy.php?url=",e="http://www.srf.ch/player/tv/carouselvideosajax/mostviews",f="http://www.srf.ch/player/tv/suche?query=",g="http://www.srf.ch/player/tv/sendungen-nach-datum",h="http://www.srf.ch/player/tv/sendungen-nach-thema",l="http://tvprogramm.srf.ch/",n=[{_id:"nachrichten",_value:["az_unit_NewsPolitikWirtschaft"]},{_id:"politik",_value:["az_unit_Konsum","az_unit_MenschGesellschaft"]},{_id:"sport",_value:["az_unit_Sport"]},{_id:"kinder",_value:["az_unit_Kinder"]},{_id:"ratgeber-gesundheit",_value:["az_unit_Gesundheit"]},{_id:"wirtschaft",_value:["az_unit_NewsPolitikWirtschaft"]},{_id:"unterhaltung",_value:["az_unit_Unterhaltung","az_unit_SatireComedy"]},{_id:"kino-tv",_value:["az_unit_FilmSerien"]},{_id:"wissen-kultur",_value:["az_unit_WissenDigital","az_unit_Kultur","az_unit_Musik","az_unit_Religion"]}];return init=function(a){b=a},getSRFVideosByDate=function(a,b,d){var e={};Date.prototype.addDays=function(a){var b=new Date(this.valueOf());return b.setDate(b.getDate()+a),b};for(var f=[],g=new Date(b),h=new Date(d);h>=g;){var j="",k=g.getDate(),m=g.getMonth()+1,n=g.getFullYear();10>k&&(k="0"+k),10>m&&(m="0"+m),j=k+"."+m+"."+n,f.push(j),g=g.addDays(1)}for(i=0;i<f.length;i++){var p=c+l+String(f[i]);$.ajax({url:p,type:"GET",cache:!1,success:function(a){_onSRFVideosByDate(a,e)},error:function(a,b,c){console.warn("ERROR; SRFService.getSRFVideosByDate; AJAX-request did not recieve a response\n",a,b,c)}})}},_checkSRFDuplicates=function(a,b){for(i=0;i<a.length;i++)if(a[i].match(b))return!1;return!0},_onSRFVideosByDate=function(a,d){var e=[],f=$(a).find("#programchannels");f.each(function(a,f){var g=$(f).find(".vod");g.each(function(a,f){var g=c+$(f).attr("href");assetID=g.substring(g.indexOf("id=")+3,g.indexOf("&referrer")),_checkSRFDuplicates(e,assetID)&&($.ajax({url:g,type:"GET",cache:!1,success:function(a){var c=[],e=[],f="",g="",h=0,i="",j="",k="",l="",m="",n=null,o=null;if(j=$(a).find("#asset_info_topline").text(),j.indexOf("vom")>1&&j.indexOf(".")>1)j=j.slice(j.indexOf("vom ")+4,j.indexOf("Uhr"));else try{var p=new Date,q=new Date,r=q.getDate(),s=q.getMonth()+1,t=q.getFullYear();10>r&&(r="0"+r),10>s&&(s="0"+s),q=r+"."+s+"."+t;var u=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];if("Heute"===j)j=q;else if("Gestern"===j){var v=new Date(p);v.setDate(p.getDate()-1);var r=v.getDate(),s=v.getMonth()+1,t=v.getFullYear();10>r&&(r="0"+r),10>s&&(s="0"+s),v=r+"."+s+"."+t,j=v}else{for(var w=0;w<u.length;w++)u[w].match(j)&&(o=w),u[w].match(u[p.getDay()])&&(n=w);if(j=new Date,n>o){var x=parseInt(n-o);j.setDate(p.getDate()-x)}if(o>n){var y=parseInt(n+u.length-o);j.setDate(p.getDate()-y)}var r=j.getDate(),s=j.getMonth()+1,t=j.getFullYear();10>r&&(r="0"+r),10>s&&(s="0"+s),j=r+"."+s+"."+t}}catch(z){}j.indexOf(",")>0&&(j=j.replace(",","")),f=$(a).find("#asset_info_description").text(),k="SRF",g=$(a).find("#asset_info_hl").text();var A=$(a).find("#sendung_box_logo").find(".retina_image").attr("width")+"x"+$(a).find(".retina_image").attr("height"),B=$(a).find("#sendung_box_logo").find(".retina_image").attr("src"),C=b.createTeaserImage(A,B);c.push(C);var D=2*$(a).find("#sendung_box_logo").find(".retina_image").attr("width")+"x"+2*$(a).find(".retina_image").attr("height"),E=$(a).find("#sendung_box_logo").find(".retina_image").attr("data-src2x"),F=b.createTeaserImage(D,E);if(c.push(F),l=$(a).find(".button_download_img").attr("href"),"undefined"!==l&&void 0!==l){var G="",H="",I="",J=0,K="video/mp4";I=l,I.indexOf("q10")>0?H=0:I.indexOf("q20")>0?H=1:I.indexOf("q30")>0&&(H=2);var L=b.createStream(G,K,H,I,J);e.push(L)}if(e.length<1){var M=_getFurtherSRFStreams(h);e.length<1||_pushSRFResultToModel(d,g,m,f,k,h,i,j,c,M)}else _pushSRFResultToModel(d,g,m,f,k,h,i,j,c,e)},error:function(a,b,c){console.warn("ERROR; SRFService._onSRFVideosByDate; AJAX-request did not recieve a response\n",a,b,c)}}),e.push(assetID))})})},getSRFCategories=function(a){var b={_channel:"SRF",_method:"getCategories",_searchTerm:a,_badge:null};$.ajax({url:c+h,type:"GET",cache:!1,complete:function(c){_onSRFBroadcastOfCategory(b,c,a)},error:function(a,b,c){console.warn("ERROR; SRFService.getSRFCategories; AJAX-request did not recieve a response\n",a,b,c)}})},_onSRFBroadcastOfCategory=function(a,c,d){var e=n.filter(function(a){return a._id==d});e.length>0?$.each(e[0]._value,function(d,e){var f="#"+e,g=c.responseText,h=$(g).find(f);h.each(function(c,d){var e=$(d).find(".az_item");e.each(function(c,d){var e=[],f=[],g="",h="",i=0,j="",k="",l="",n="";g=$(d).find(".az_description").text(),l="SRF",h=$(d).find(".sendung_name").text();var o=$(d).find(".retina_image").attr("width")+"x"+$(d).find(".retina_image").attr("height"),p=$(d).find(".retina_image").attr("src"),q=b.createTeaserImage(o,p);e.push(q);var r=2*$(d).find(".retina_image").attr("width")+"x"+2*$(d).find(".retina_image").attr("height"),s=$(d).find(".retina_image").attr("data-src2x"),t=b.createTeaserImage(r,s);e.push(t);var u="http://www.srf.ch/"+$(d).find(".last_episode_link").attr("href");i=u.substring(u.indexOf("quicklink/")+10,u.length),_searchSRFStreams(a,u,h,n,g,l,i,j,k,e,f)})})}):console.warn("ERROR; ARTEService.getCategories; Category not found")},getHot=function(){var a={_channel:"SRF",_method:"getHot",_searchTerm:null,_badge:"hot"};$.ajax({url:c+e,type:"GET",cache:!1,complete:function(b){_onSRFGetHot(a,b)},error:function(a,b,c){console.warn("ERROR; SRFService.getHot; AJAX-request did not recieve a response\n",a,b,c)}})},_onSRFGetHot=function(a,c){var d=c.responseText,e=$(d).find(".carousel_teaser");e.each(function(c,d){var e=[],f=[],g="",h="",i=0,j="",k="",l="",n="";n=$(d).find(".format").text(),k=$(d).find(".format").next().text();var o=new Date,p=new Date,q=p.getDate(),r=p.getMonth()+1,s=p.getFullYear();10>q&&(q="0"+q),10>r&&(r="0"+r),p=q+"."+r+"."+s;var t=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];if("Heute"===k)k=p;else if("Gestern"===k){var u=new Date(o);u.setDate(o.getDate()-1);var q=u.getDate(),r=u.getMonth()+1,s=u.getFullYear();10>q&&(q="0"+q),10>r&&(r="0"+r),u=q+"."+r+"."+s,k=u}else{for(var v=null,w=null,x=0;x<t.length;x++)t[x].match(k)&&(w=x),t[x].match(t[o.getDay()])&&(v=x);if(k=new Date,v>w){var y=parseInt(v-w);k.setDate(o.getDate()-y)}if(w>v){var z=parseInt(v+t.length-w);k.setDate(o.getDate()-z)}var q=k.getDate(),r=k.getMonth()+1,s=k.getFullYear();10>q&&(q="0"+q),10>r&&(r="0"+r),k=q+"."+r+"."+s}l="SRF",h=$(d).find(".headline").text();var A=$(d).find(".retina_image").attr("width")+"x"+$(d).find(".retina_image").attr("height"),B=$(d).find(".retina_image").attr("src"),C=b.createTeaserImage(A,B);e.push(C);var D=2*$(d).find(".retina_image").attr("width")+"x"+2*$(d).find(".retina_image").attr("height"),E=$(d).find(".retina_image").attr("data-src2x"),F=b.createTeaserImage(D,E);e.push(F);var G="http://www.srf.ch/"+$(d).find(".headline").attr("href");i=G.substring(G.indexOf("id=")+3,G.length),_searchSRFStreams(a,G,h,n,g,l,i,j,k,e,f)})},getNew=function(a){var b={_channel:"SRF",_method:"getNew",_searchTerm:null,_badge:"new"};$.ajax({url:c+g,type:"GET",cache:!1,success:function(c){_onSRFGetNew(a,b,c,"#left_day")},error:function(a,b,c){console.warn("ERROR; SRFService.getNew; AJAX-request did not recieve a response\n",a,b,c)}})},_onSRFGetNew=function(a,d,e,f){a&&void 0!==a&&null!==a||(a=50);var g=f,h=$(e).find(f).find(".missed_list"),i=1;h.each(function(e,f){var g=$(f).find(".sendung_item");g.each(function(e,f){if(a>=i){var g=$(f).attr("id");if("undefined"!=typeof g&&g!==!1){var h=[],j=[],k="",l="",m=0,n="",o="",p="",q="",r="";$today=new Date,$yesterday=new Date($today),$yesterday.setDate($today.getDate()-1);var s=$yesterday.getDate(),t=$yesterday.getMonth()+1,u=$yesterday.getFullYear();10>s&&(s="0"+s),10>t&&(t="0"+t),$yesterday=s+"."+t+"."+u,o=$yesterday+" "+$(f).find(".time").text(),o.indexOf(" Uhr")>0&&(o=o.substring(0,o.indexOf(" Uhr"))),p="SRF",l=$(f).find(".title").attr("title");var v=$(f).find(".retina_image").attr("width")+"x"+$(f).find(".retina_image").attr("height"),w=$(f).find(".retina_image").attr("src"),x=b.createTeaserImage(v,w);h.push(x);var y=2*$(f).find(".retina_image").attr("width")+"x"+2*$(f).find(".retina_image").attr("height"),z=$(f).find(".retina_image").attr("data-src2x"),A=b.createTeaserImage(y,z);h.push(A);var B="http://www.srf.ch/"+$(f).find(".sengung_logo_wrapper").attr("href");m=B.substring(B.indexOf("id=")+3,B.length),1===a?$.ajax({url:c+B,type:"GET",cache:!1,success:function(a){if((null===r||void 0===r||""===r)&&(r=$(a).find("#asset_info_hl").text()),(null===k||void 0===k||""===k)&&(k=$(a).find("#asset_info_description").text()),null===o||void 0===o||""===o)if(o=$(a).find("#asset_info_topline").text(),o.indexOf("vom")>1&&o.indexOf(".")>1)o=o.slice(o.indexOf("vom ")+4,o.indexOf(" Uhr"));else try{var f=new Date,g=new Date,s=g.getDate(),t=g.getMonth()+1,u=g.getFullYear();10>s&&(s="0"+s),10>t&&(t="0"+t),g=s+"."+t+"."+u;var v=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];if("Heute"===o)o=g;else if("Gestern"===o){var w=new Date(f);w.setDate(f.getDate()-1);var s=w.getDate(),t=w.getMonth()+1,u=w.getFullYear();10>s&&(s="0"+s),10>t&&(t="0"+t),w=s+"."+t+"."+u,o=w}else{for(var x=null,y=null,z=0;z<v.length;z++)v[z].match(o)&&(y=z),v[z].match(v[f.getDay()])&&(x=z);if(o=new Date,x>y){var A=parseInt(x-y);o.setDate(f.getDate()-A)}if(y>x){var B=parseInt(x+v.length-y);o.setDate(f.getDate()-B)}var s=o.getDate(),t=o.getMonth()+1,u=o.getFullYear();10>s&&(s="0"+s),10>t&&(t="0"+t),o=s+"."+t+"."+u}}catch(C){}if(q=$(a).find(".button_download_img").attr("href"),"undefined"!==q&&void 0!==q){var D="",E="",F="",G=0,H="video/mp4";F=q,F.indexOf("q10")>0?E=0:F.indexOf("q20")>0?E=1:F.indexOf("q30")>0&&(E=2);var I=b.createStream(D,H,E,F,G);j.push(I)}j.length<1?(j=_getFurtherSRFStreams(m),j.length<1||(i++,_pushSRFResultToModel(d,l,r,k,p,m,n,o,h,streams2))):(++i,_pushSRFResultToModel(d,l,r,k,p,m,n,o,h,j))},error:function(a,b,c){console.warn("ERROR; SRFService._onSRFGetNew; AJAX-request did not recieve a response\n",a,b,c)}}):(_searchSRFStreams(d,B,l,r,k,p,m,n,o,h,j),++i)}}})}),"#left_day"===g&&_onSRFGetNew(d,e,"#right_day")},searchString=function(a,b){a.indexOf(" ")>0&&(a=a.replace(" ","+")),(1>b||null===b||"undefined"===b||void 0===b)&&(b=2);var d={_channel:"SRF",_method:"searchString",_searchTerm:a,_badge:null};for(i=1;b>=i;i++){var e=c+encodeURI(f+String(a))+"&page="+String(i);$.ajax({url:e,type:"GET",cache:!1,success:function(a){_onSRFSearchString(d,a)},error:function(a,b,c){console.warn("ERROR; SRFService.searchString; AJAX-request did not recieve a response\n",a,b,c)}})}},_onSRFSearchString=function(a,c){var d=$(c).find(".result_row");d.each(function(c,d){var e=[],f=[],g="",h="",i=0,j="",k="",l="",n="";n=$(d).find(".title_infos_description").find(".sender").text(),k=$(d).find(".title_infos_description").find(".sender").next().text();var o=new Date,p=new Date,q=p.getDate(),r=p.getMonth()+1,s=p.getFullYear();10>q&&(q="0"+q),10>r&&(r="0"+r),p=q+"."+r+"."+s;var t=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];if("Heute"===k)k=p;else if("Gestern"===k){var u=new Date(o);u.setDate(o.getDate()-1);var q=u.getDate(),r=u.getMonth()+1,s=u.getFullYear();10>q&&(q="0"+q),10>r&&(r="0"+r),u=q+"."+r+"."+s,k=u}else{for(var v=null,w=null,x=0;x<t.length;x++)t[x].match(k)&&(w=x),t[x].match(t[o.getDay()])&&(v=x);if(k=new Date,v>w){var y=parseInt(v-w);k.setDate(o.getDate()-y)}if(w>v){var z=parseInt(v+t.length-w);k.setDate(o.getDate()-z)}var q=k.getDate(),r=k.getMonth()+1,s=k.getFullYear();10>q&&(q="0"+q),10>r&&(r="0"+r),k=q+"."+r+"."+s}l="SRF",j=$(d).find(".title_infos_description").find(".duration").text(),j=j.substring(7,100),j=_fixLength(j),g=$(d).find(".title_infos_description").find(".result_description").text(),h=$(d).find(".title_infos_description").find(".result_title").attr("title");var A=$(d).find(".sendung_img_wrapper").find(".retina_image").attr("width")+"x"+$(d).find(".sendung_img_wrapper").find(".retina_image").attr("height"),B=$(d).find(".sendung_img_wrapper").find(".retina_image").attr("src"),C=b.createTeaserImage(A,B);e.push(C);var D=2*$(d).find(".sendung_img_wrapper").find(".retina_image").attr("width")+"x"+2*$(d).find(".sendung_img_wrapper").find(".retina_image").attr("height"),E=$(d).find(".sendung_img_wrapper").find(".retina_image").attr("data-src2x"),F=b.createTeaserImage(D,E);e.push(F);var G="http://www.srf.ch/"+$(d).find(".title_infos_description").find(".result_title").attr("href");i=G.substring(G.indexOf("id=")+3,G.length),_searchSRFStreams(a,G,h,n,g,l,i,j,k,e,f)})},_searchSRFStreams=function(a,d,e,f,g,h,i,j,k,l,m){$.ajax({url:c+d,type:"GET",cache:!1,success:function(c){if((null===f||void 0===f||""===f)&&(f=$(c).find("#asset_info_hl").text()),(null===g||void 0===g||""===g)&&(g=$(c).find("#asset_info_description").text()),null===k||void 0===k||""===k)if(k=$(c).find("#asset_info_topline").text(),k.indexOf("vom")>1&&k.indexOf(".")>1)k=k.slice(k.indexOf("vom ")+4,k.indexOf(" Uhr"));else try{var o=new Date,p=new Date,q=p.getDate(),r=p.getMonth()+1,s=p.getFullYear();10>q&&(q="0"+q),10>r&&(r="0"+r),p=q+"."+r+"."+s;var t=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];if("Heute"===k)k=p;else if("Gestern"===k){var u=new Date(o);u.setDate(o.getDate()-1);var q=u.getDate(),r=u.getMonth()+1,s=u.getFullYear();10>q&&(q="0"+q),10>r&&(r="0"+r),u=q+"."+r+"."+s,k=u}else{for(var v=null,w=null,x=0;x<t.length;x++)t[x].match(k)&&(w=x),t[x].match(t[o.getDay()])&&(v=x);if(k=new Date,v>w){var y=parseInt(v-w);k.setDate(o.getDate()-y)}if(w>v){var z=parseInt(v+t.length-w);k.setDate(o.getDate()-z)}var q=k.getDate(),r=k.getMonth()+1,s=k.getFullYear();10>q&&(q="0"+q),10>r&&(r="0"+r),k=q+"."+r+"."+s}}catch(A){}if(streamUrl=$(c).find(".button_download_img").attr("href"),"undefined"!==streamUrl&&void 0!==streamUrl){var B="",C="",D="",E=0,F="video/mp4";D=streamUrl,D.indexOf("q10")>0?C=0:D.indexOf("q20")>0?C=1:D.indexOf("q30")>0&&(C=2);var G=b.createStream(B,F,C,D,E);m.push(G)}m.length<1?(m=_getFurtherSRFStreams(i),m.length<1||_pushSRFResultToModel(a,e,f,g,h,i,j,k,l,streams2)):_pushSRFResultToModel(a,e,f,g,h,i,j,k,l,m)},error:function(a,b,c){console.warn("ERROR; SRFService._searchSRFStreams; AJAX-request did not recieve a response\n",a,b,c)}})},_getFurtherSRFStreams=function(){return[]},_fixLength=function(a){if(a.indexOf(" Min")>0&&(a=a.replace(" Min","")),Number(a)>60){var b=String(parseInt(a/60));Number(b)<10&&(b="0"+String(b));var c=String(Number(a)-60*Number(b));return Number(c)<10&&(c="0"+String(c)),b+":"+c+":00"}return Number(a)<=60?(Number(a)<10&&(a="0"+String(a)),"00:"+String(a)+":00"):a},_pushSRFResultToModel=function(a,c,d,e,f,g,h,i,j,k){b.addResults(a,f,c,d,e,h,i,j,k)},dispose=function(){a={}},a.init=init,a.dispose=dispose,a.searchString=searchString,a.getNew=getNew,a.getHot=getHot,a.getSRFCategories=getSRFCategories,a.getSRFVideosByDate=getSRFVideosByDate,a};