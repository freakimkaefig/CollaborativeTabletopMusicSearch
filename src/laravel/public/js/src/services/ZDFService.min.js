MediathekCrawler.ZDFService=function(){var a={},b="http://www.zdf.de/ZDFmediathek/xmlservice/web/detailsSuche?searchString=",c="http://www.zdf.de/ZDFmediathek/xmlservice/web/beitragsDetails?id=",d="http://www.zdf.de/ZDFmediathek/xmlservice/web/aktuellste?id=",e="http://www.zdf.de/ZDFmediathek/xmlservice/web/meistGesehen?id=_GLOBAL&maxLength=",f="http://www.zdf.de/ZDFmediathek/xmlservice/web/aktuellste?id=",g="http://www.zdf.de/ZDFmediathek/xmlservice/web/aktuellste?id=",h="http://www.zdf.de/ZDFmediathek/xmlservice/web/sendungVerpasst?startdate=",i="&enddate=",j="&maxLength=",k=322,l=857392,m=398,n=1321386,p=null,q=[{_id:"nachrichten",_assetId:["884718"]},{_id:"politik",_assetId:["884720"]},{_id:"sport",_assetId:["884726"]},{_id:"kinder",_assetId:["884712"]},{_id:"ratgeber-gesundheit",_assetId:["884722"]},{_id:"unterhaltung",_assetId:["884728"]},{_id:"kino-tv",_assetId:["884724","884708","884714"]},{_id:"wissen-kultur",_assetId:["884730","884716"]}];return init=function(a){p=a},searchString=function(a,c){c>=50&&(c=50);var d={_channel:"ZDF",_method:"searchString",_searchTerm:a,_badge:null};$.ajax({url:b+a+"&maxLength="+String(c),type:"GET",cache:!1,success:function(a){_parseResponse(d,a)},error:function(a,b,c){console.warn("ERROR; ZDFService.searchString; AJAX-request did not recieve a response\n",a,b,c)}})},_replaceAll=function(a,b,c){return c.replace(new RegExp(a,"g"),b)},getZDFVideosByDate=function(a,b,c){a>=50&&(a=50);var d={};b.indexOf("-")>0&&(b=_replaceAll("-","",b)),startYYYY=b.slice(2,4),startMM=b.slice(4,6),startDD=b.slice(6,8),b=startDD+startMM+startYYYY,c.indexOf("-")>0&&(c=_replaceAll("-","",c)),endYYYY=c.slice(2,4),endMM=c.slice(4,6),endDD=c.slice(6,8),c=endDD+endMM+endYYYY,$.ajax({url:encodeURI(h+String(b)+i+String(c)+j+String(a)),type:"GET",cache:!1,success:function(a){_parseResponse(d,a)},error:function(a,b,c){console.warn("ERROR; ZDFService.getZDFVideosByDate; AJAX-request did not recieve a response\n",a,b,c)}})},_parseResponse=function(a,b){if($xml=$(b),"undefined"!=typeof $xml){var c=$xml.find("teaser");c.each(function(){var b=[],c="",d="",e=0,f="",g="",h="",i="",j=$(this).find("teaserimage");j.each(function(){var a=$(this).attr("key"),c=$(this).text();if(0!==a&&a.length>6){var d=p.createTeaserImage(a,c);b.push(d)}}),d=$(this).find("title").text(),c=$(this).find("detail").text(),h=$(this).find("channel").text(),e=$(this).find("assetId").text(),f=$(this).find("length").text(),f.indexOf(".")>0?(end=f.indexOf("."),f=f.substring(0,end)):f.indexOf("min")>0?(end=f.indexOf("min"),f=_formatSeconds(60*f.substring(0,end-1))):f.length<6&&-1===f.indexOf("min")&&-1===f.indexOf(":")&&(f=_formatSeconds(60*f)),g=$(this).find("airtime").text(),_searchStream(a,e,d,i,c,h,f,g,b)})}},_searchStream=function(a,b,d,e,f,g,h,i,j){var k=[];$.ajax({url:c+b,type:"GET",cache:!1,success:function(c){if($xml=$(c),"undefined"!=typeof $xml){var l=$xml.find("formitaet");l.each(function(){var a="",b="",c="",d=0;switch(a=$(this).attr("basetype")){case"h264_aac_3gp_rtsp_na_na":type=null;break;case"h264_aac_f4f_http_f4m_http":type=null;break;case"h264_aac_mp4_http_na_na":switch(type="video/mp4",c=$(this).find("url").text(),qualityText=$(this).find("quality").text()){case"low":b=0;break;case"med":b=1;break;case"high":b=2;break;case"veryhigh":b=3}if(-1==c.indexOf("metafilegenerator")){d=$(this).find("filesize").text();var e=p.createStream(a,type,b,c,d);k.push(e)}case"h264_aac_mp4_rtmp_smil_http":type=null;break;case"h264_aac_mp4_rtmp_zdfmeta_http":type=null;break;case"h264_aac_mp4_rtsp_mov_http":type=null;break;case"h264_aac_ts_http_m3u8_http":type=null;break;case"vp8_vorbis_webm_http_na_na":type=null;break;var e;default:type="video/mp4"}}),k.length<1||_pushResultToModel(a,d,e,f,g,b,h,i,j,k)}},error:function(a,b,c){console.warn("ERROR; ZDFService._searchStream; AJAX-request did not recieve a response\n",a,b,c)}})},_pushResultToModel=function(a,b,c,d,e,f,g,h,i,j){p.addResults(a,e,b,c,d,g,h,i,j)},getHot=function(a){a>50&&(a=50);var b={_channel:"ZDF",_method:"getHot",_searchTerm:null,_badge:"hot"};$.ajax({url:e+String(a)+"&offset=1",type:"GET",cache:!1,success:function(a){_parseResponse(b,a)},error:function(a,b,c){console.warn("ERROR; ZDFService.getHot; AJAX-request did not recieve a response\n",a,b,c)}})},getNew=function(a){a>50&&(a=50);var b={_channel:"ZDF",_method:"getNew",_searchTerm:null,_badge:"new"};a>1?(a=parseInt(a/4),$.ajax({url:d+k+"&maxLength="+String(a),type:"GET",cache:!1,success:function(a){_parseResponse(b,a)},error:function(a,b,c){console.warn("ERROR; ZDFService.getNew; AJAX-request did not recieve a response\n",a,b,c)}}),$.ajax({url:d+l+"&maxLength="+String(a),type:"GET",cache:!1,success:function(a){_parseResponse(b,a)},error:function(a,b,c){console.warn("ERROR; ZDFService.getNew; AJAX-request did not recieve a response\n",a,b,c)}}),$.ajax({url:d+n+"&maxLength="+String(a),type:"GET",cache:!1,success:function(a){_parseResponse(b,a)},error:function(a,b,c){console.warn("ERROR; ZDFService.getNew; AJAX-request did not recieve a response\n",a,b,c)}}),$.ajax({url:d+m+"&maxLength="+String(a),type:"GET",cache:!1,success:function(a){_parseResponse(b,a)},error:function(a,b,c){console.warn("ERROR; ZDFService.getNew; AJAX-request did not recieve a response\n",a,b,c)}})):$.ajax({url:d+k+"&maxLength=1",type:"GET",cache:!1,success:function(a){_parseResponse(b,a)},error:function(a,b,c){console.warn("ERROR; ZDFService.getNew; AJAX-request did not recieve a response\n",a,b,c)}})},getCategories=function(a,b){var c={_channel:"ZDF",_method:"getCategories",_searchTerm:a,_badge:null},d=q.filter(function(b){return b._id==a});d.length>0?$.each(d[0]._assetId,function(a,d){_getBroadcastOfCategory(c,d,b)}):console.warn("ERROR; ZDFService.getCategories; Category not found")},_getBroadcastOfCategory=function(a,b,c){$.ajax({url:f+String(b)+"&maxLength=50",type:"GET",cache:!1,success:function(b){if($xml=$(b),"undefined"!=typeof $xml){var d=$xml.find("teaser");d.each(function(){var b=0;b=$(this).find("assetId").text(),_getVideosOfBroadcast(a,b,c)})}},error:function(a,b,c){console.warn("ERROR; ZDFService._getBroadcastOfCategory; AJAX-request did not recieve a response\n",a,b,c)}})},_getVideosOfBroadcast=function(a,b,c){$.ajax({url:g+String(b)+"&maxLength="+String(c),type:"GET",cache:!1,success:function(b){if($xml=$(b),"undefined"!=typeof $xml){var c=$xml.find("teaser");c.each(function(){var b=0;b=$(this).find("assetId").text(),_getDetailsAndStreamOfVideo(a,b)})}},error:function(a,b,c){console.warn("ERROR; ZDFService._getVideosOfBroadcast; AJAX-request did not recieve a response\n",a,b,c)}})},_getDetailsAndStreamOfVideo=function(a,b){$.ajax({url:c+b,type:"GET",cache:!1,success:function(b){if($xml=$(b),"undefined"!=typeof $xml){var c=$xml.find("video");c.each(function(){var b=[],c="",d="",e=0,f="",g="",h="",i="",k=$(this).find("teaserimage");k.each(function(){var a=$(this).attr("key"),c=$(this).text();if(0!==a&&a.length>6){var d=p.createTeaserImage(a,c);b.push(d)}}),d=$(this).find("title").text(),c=$(this).find("detail").text(),h=$(this).find("channel").text(),e=$(this).find("assetId").text(),f=$(this).find("length").text(),f.indexOf(".")>0?(end=f.indexOf("."),f=f.substring(0,end)):f.indexOf("min")>0&&(end=f.indexOf("min"),f=_formatSeconds(60*f.substring(0,end-1))),g=$(this).find("airtime").text(),_searchStream(a,e,d,i,c,h,f,g,b)})}},error:function(a,b,c){console.warn("ERROR; ZDFService._getDetailsAndStreamOfVideo; AJAX-request did not recieve a response\n",a,b,c)}})},_formatSeconds=function(a){var b=new Date(1970,0,1);return b.setSeconds(a),b.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},dispose=function(){a={}},a.init=init,a.dispose=dispose,a.searchString=searchString,a.getHot=getHot,a.getNew=getNew,a.getCategories=getCategories,a.getZDFVideosByDate=getZDFVideosByDate,a};