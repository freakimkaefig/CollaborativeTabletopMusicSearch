MediathekCrawler.ApplicationController=function(){var a={},b=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=20,o=20,p=1,q=function(){console.info("MediathekCrawler.ApplicationController.init"),b=MediathekCrawler.MediathekModel(),b.init(),"http://mediathek-crawler/"===document.URL||"http://mediathek.lukaslamm.de/"===document.URL?$(b).on("resultReceived",t):$(b).on("resultReceived",r),d=MediathekCrawler.DasErsteService(),d.init(b),e=MediathekCrawler.ZDFService(),e.init(b),f=MediathekCrawler.BRService(),f.init(b),g=MediathekCrawler.ARTEService(),g.init(b),i=MediathekCrawler.SRFService(),i.init(b),h=MediathekCrawler.ORFService(),h.init(b),j=MediathekCrawler.MainView(),j.init(),k=MediathekCrawler.FooterView(),k.init(),feedbackView=MediathekCrawler.FeedbackView(),feedbackView.init(),l=MediathekCrawler.ResultView(),l.init(),m=MediathekCrawler.BroadcastView(),m.init(),playlistView=MediathekCrawler.PlaylistView(),playlistView.init(),bookmarkView=MediathekCrawler.BookmarkView(),bookmarkView.init(),searchView=MediathekCrawler.SearchView(),searchView.init(),v(),$(m).on("feedback",u),$(playlistView).on("feedback",u),$(bookmarkView).on("feedback",u)},r=function(a,b){$("#sort-buttons").removeClass("hidden"),document.URL.indexOf("/channel/")>-1&&$("#hot-new-sort").removeClass("hidden"),document.URL.indexOf("/suche")>-1?$("#duration-slider").slider("value")<1?(l.appendResult(b),s()):$(document).ajaxStop(x(searchView.getSliderValue())):(l.appendResult(b),s())},s=function(){$("#alphabetic-sort").empty(),$("#alphabetic-sort").append("Alphabetisch"),$("#hot-new-sort").empty(),$("#hot-new-sort").append("Hot/New"),$("#date-sort").empty(),$("#date-sort").append("Datum"),$("#channel-sort").empty(),$("#channel-sort").append("Sender"),$("#duration-sort").empty(),$("#duration-sort").append("Dauer")},t=function(a,b){l.fillSlider(a,b)},u=function(a,b){console.log("feedback"),feedbackView.showFeedback(b)},v=function(){var a=document.URL.toLowerCase();if(("http://mediathek-crawler/"===document.URL||"http://mediathek.lukaslamm.de/"===document.URL||"http://mediathek.lukaslamm.de/#"===document.URL)&&(d.getNew(1),e.getNew(1),g.getNew(1),f.getBRNew(1),h.getNew(1),i.getNew(1)),a.indexOf("/new")>-1&&A(),a.indexOf("/hot")>-1&&B(),a.indexOf("/channel")>-1&&(a.indexOf("/channel/zdf")>-1&&(e.getNew(n),e.getHot(n)),a.indexOf("/channel/arte")>-1&&(g.getNew(o),g.getHot(o)),a.indexOf("/channel/daserste")>-1&&(d.getNew(),d.getHot()),a.indexOf("/channel/srf")>-1&&(i.getNew(),i.getHot()),a.indexOf("/channel/br")>-1&&(f.getBRNew(),f.getBRHot()),a.indexOf("/channel/orf")>-1&&(h.getNew(20),h.getHot())),a.indexOf("/suche")>-1||a.indexOf("/suche-mobile")>-1){var b=$('input[name="search"]').val();""!==b&&void 0!==b?(y(b),$("#submit").on("click",w)):$("#submit").on("click",w)}if(a.indexOf("/video")>-1&&(a.indexOf("/video/bookmark")>-1?D():C()),a.indexOf("/rubrik")>-1){var a=a.split("/"),c=a[a.length-1];z(c.toLowerCase())}a.indexOf("/playlists/playlist")>-1&&console.log("ich bin in einer palyliste")},w=function(){b.clearResults(),$("#result-wrapper").empty();var c=searchView.getSelectedChannels(),j=searchView.getSelectedCategories();if($("#xs-helper").is(":visible"))var k=$('input[name="search-mobile"').val();else var k=$('input[name="search"]').val();var l=searchView.getDateFrom(),m=searchView.getDateTo();searchView.getSliderValue(),c.length>0?c.forEach(function(a){var b=a;j.length>0?j.forEach(function(a){"arte"==b&&g.getCategories(a),"zdf"==b&&e.getCategories(a,1),"srf"==b&&i.getSRFCategories(a),"br"==b&&f.searchString(a,0),"daserste"==b&&d.searchString(a,0),"orf"==b&&h.searchString(a)}):""!==k&&void 0!==k?("arte"==b&&g.searchString(k,o),"zdf"==b&&e.searchString(k,n),"daserste"==b&&d.searchString(k,0),"srf"==b&&i.searchString(k,p),"br"==b&&f.searchString(k,0),"orf"==b&&h.searchString(k)):""!=l?("zdf"==b&&e.getZDFVideosByDate(50,l,m),"arte"==b&&g.getVideosByDate(200,l,m),"daserste"==b&&d.getDasErsteVideosByDate(0,l,m),"srf"==b&&i.getSRFVideosByDate(0,l,m),"br"==b&&f.getBRVideosByDate(l,m)):("arte"==b&&(g.getNew(o),g.getHot(o),$("#hot-new-sort").removeClass("hidden")),"zdf"==b&&(e.getNew(n),e.getHot(n),$("#hot-new-sort").removeClass("hidden")),"daserste"==b&&(d.getNew(),d.getHot(),$("#hot-new-sort").removeClass("hidden")),"srf"==b&&(i.getHot(),i.getNew(),$("#hot-new-sort").removeClass("hidden")),"br"==b&&(f.getBRHot(),f.getBRNew(),$("#hot-new-sort").removeClass("hidden")),"orf"==b&&(h.getHot(),h.getNew(),$("#hot-new-sort").removeClass("hidden")))}):j.length>0?j.forEach(function(a){g.getCategories(a),e.getCategories(a,1),i.getSRFCategories(a),f.searchString(a,0),d.searchString(a,0),h.searchString(a)}):""!==k&&void 0!=k?y(k):""!=l&&""!=m?(e.getZDFVideosByDate(200,l,m),g.getVideosByDate(200,l,m),d.getDasErsteVideosByDate(200,l,m),f.getBRVideosByDate(l,m)):console.log("NO FILTERS MATCHED!"),searchView.collapseMobileFilter()},x=function(a){if($("#result-wrapper").empty(),a>0){results=JSON.parse(localStorage.getItem("mediathek-crawler"))._results;var b=[];results.forEach(function(c){time=c._length.split(":"),timeInMinutes=parseInt(time[1]),time[0]>0&&(timeInMinutes+=60*parseInt(time[0])),timeInMinutes>=a&&b.push(c)});var c=0;b.forEach(function(a){b[c]._id=c,l.appendResult(a),c++}),s(),b=JSON.stringify(b),b='{"_results":'+b+"}",localStorage.setItem("mediathek-crawler",b),results=JSON.parse(localStorage.getItem("mediathek-crawler"))._results}},y=function(a){b.clearResults(),d.searchString(a,0),e.searchString(a,n),h.searchString(a),g.searchString(a,o),i.searchString(a,p),f.searchString(a,0)},z=function(a){e.getCategories(a,2),g.getCategories(a),i.getSRFCategories(a),f.searchString(a,0),d.searchString(a,0),h.searchString(a)},A=function(){d.getNew(),e.getNew(n),g.getNew(o),i.getNew(),f.getBRNew(),h.getNew()},B=function(){d.getHot(),e.getHot(n),g.getHot(o),i.getHot(),f.getBRHot(),h.getHot()},C=function(){var a=$("#video-id").val();m.renderVideoById(a)},D=function(){var a=$("#video-id").val();m.renderVideoBookmark(a)},E=function(){a={}};return a.init=q,a.dispose=E,a};